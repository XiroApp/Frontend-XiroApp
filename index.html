<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="shortcut icon" href="favicon.ico" type="image/x-icon" />
    <title>XIRO APP - Tu mejor compañero</title>

    <!-- Meta descripción para SEO -->
    <meta
      name="description"
      content="Accede de manera rápida y sencilla a materiales de estudio impresos y artículos de librería"
    />

    <!-- Open Graph para redes sociales -->
    <meta property="og:url" content="https://xiroapp.com.ar" />
    <meta property="og:type" content="website" />
    <meta property="og:title" content="XIRO APP" />
    <meta
      property="og:description"
      content="Accede de manera rápida y sencilla a materiales de estudio impresos y artículos de librería"
    />
    <meta
      property="og:image"
      content="https://opengraph.b-cdn.net/production/images/04d5ded6-860b-44da-a974-eb6c95d13848.png"
    />

    <!-- Twitter Card básica -->
    <meta name="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="https://xiroapp.com.ar" />

    <!-- Control de cache para HTML -->
    <meta
      http-equiv="Cache-Control"
      content="no-cache, no-store, must-revalidate"
    />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />

    <script>
      const APP_VERSION = "5.0.2(beta)"; // Reemplazar dinámicamente en el build

      (async function cleanupIfNeeded() {
        try {
          const storedVersion = localStorage.getItem("app-version");
          if (storedVersion !== APP_VERSION) {
            console.log("Nueva versión detectada. Limpiando datos...");

            // Limpiar localStorage y sessionStorage
            localStorage.clear();
            sessionStorage.clear();

            // Eliminar cookies
            document.cookie.split(";").forEach((cookie) => {
              document.cookie = cookie
                .replace(/^ +/, "")
                .replace(
                  /=.*/,
                  "=;expires=" + new Date(0).toUTCString() + ";path=/"
                );
            });

            // Eliminar bases de datos IndexedDB
            if (window.indexedDB?.databases) {
              const dbs = await indexedDB.databases();
              dbs.forEach((db) => indexedDB.deleteDatabase(db.name));
            }

            if ("serviceWorker" in navigator) {
              navigator.serviceWorker
                .getRegistrations()
                .then((registrations) => {
                  registrations.forEach((registration) => {
                    registration.unregister().then(() => {
                      console.log("Service Worker desregistrado.");
                    });
                  });
                });
            }
            // Eliminar caches
            if ("caches" in window) {
              const names = await caches.keys();
              await Promise.all(names.map((name) => caches.delete(name)));
            }

            // Guardar nueva versión y recargar
            localStorage.setItem("app-version", APP_VERSION);
            location.reload(); // Recargar para cargar la nueva versión
          }
        } catch (error) {
          console.error("Error durante la limpieza de datos:", error);
        }
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>

    <!-- Scripts principales -->
    <script type="module" src="/src/main.jsx" crossorigin="anonymous"></script>
    <script src="https://acrobatservices.adobe.com/view-sdk/viewer.js"></script>
  </body>
</html>
